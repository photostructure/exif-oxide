# ENTRY_COUNT POLICY

## ⚠️ CRITICAL: DO NOT ADD `entry_count` TO JSON OUTPUTS

### The Problem

Multiple times engineers have tried to add an `entry_count` field to JSON files generated by Perl extractors, thinking it would be "helpful" or "more complete". **This is wrong and breaks the system.**

### Why `entry_count` Should NEVER Be Added

1. **Duplicate Logic**: The Rust code calculates the entry count from `entries.len()`, which is the single source of truth
2. **Inconsistency Risk**: If Perl and Rust calculate differently, we get parsing failures
3. **Maintenance Burden**: Two places to maintain the same information
4. **Trust ExifTool**: We follow the principle of trusting ExifTool's data, not our calculations

### What To Do Instead

- **Perl extractors**: Emit only the `entries` array
- **Rust code**: Calculate `entry_count = entries.len()`
- **JSON schema**: Do NOT include `entry_count` field in any input schemas

### Files That Must NOT Have `entry_count`

- `codegen/extractors/simple_table.pl` 
- `codegen/extractors/boolean_set.pl`
- Any other Perl extractor that outputs JSON
- `codegen/src/config/mod.rs` - `SimpleMetadata` struct
- Any JSON schema definitions

### If You See `entry_count` Being Added

**STOP IMMEDIATELY** and:

1. Remove the `entry_count` field
2. Update the Rust code to calculate from `entries.len()`
3. Add a comment explaining why it's omitted
4. Reference this policy document

### Historical Context

This issue was fixed in July 2025 after multiple parsing failures. The root cause was Perl emitting `entry_count` while Rust expected to calculate it internally.

**Remember: Only Rust should calculate entry counts. Perl should only extract and emit the raw data.**